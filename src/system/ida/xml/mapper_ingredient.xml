<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper 태그 선언 -->
<mapper namespace="system.ida.dao.IngredientDAO">
	<!-- 가게에 등록된 식자재 목록을 가져오는 select 태그 -->
	<select id="getIngredientList" parameterType="system.ida.dto.IngredientSearchDTO" resultType="system.ida.dto.IngredientDTO">
		select
			i.i_no as "i_no"
			<!-- ,i.ia_code as "ia_code" -->
			,(select a.ia_name from code_ingredient_alpha a where a.ia_code=i.ia_code) as  "ia_name"
			,(select b.ib_name from code_ingredient_beta b where b.ib_code=i.ib_code) as "ib_name"
			,(select o.io_name from code_ingredient_origin o where o.io_code=i.io_code) as"io_name"
			,i.i_name as  "i_name"
			,i.i_size as  "i_size"
			,i.i_price  as  "i_price"
			,to_char(i.reg_date,'yyyy-mm-dd(dy)hh-mi') as   "reg_date"
			,i.is_del   as  "is_del"
			
		from ingredient i 
		where i.is_del = 'F'
			and s_no = (select s_no from store where s_id=#{s_id})
	</select>
	
	
	<!-- 대분류 목록을 검색하는 select 태그 -->
	<select id='getCodeIngAlpha' resultType="system.ida.dto.Code_IngredientAlphaDTO">
		select
			 ia_name
		from
			code_ingredient_alpha
		order by
			1
	</select>
	
	<!-- 소분류 목록을 검색하는 select 태그 -->
	<select id='getCodeIngBeta' resultType="system.ida.dto.Code_IngredientBetaDTO">
		select
			 ib_name
		from
			code_ingredient_beta
		order by
			1
	</select>
	

	<!-- 원산지 목록을 검색하는 select 태그 -->
	<select id='getCodeIngOrigin' resultType="system.ida.dto.Code_IngredientOriginDTO">
		select
			 io_name
		from
			code_ingredient_origin
		order by
			1
	</select>
	
	
	<!-- 식자재 insert -->
	<insert id="insertIngredient" parameterType="system.ida.dto.IngredientDTO">
		insert into ingredient(
			i_no
			,ia_code
			,ib_code
			,io_code
			,i_name
			,i_size
			,i_price
			,reg_date
			,is_del
		)values(
			(select nvl(max(i_no),0)+1 from ingredient)
			,(select ia_code from code_ingredient alpha where ia_name=#{ia_code})
			,(select ib_code from code_ingredient beta where ib_name=#{ib_code})
			,(select io_code from code_ingredient origin where io_name=#{io_code})
			,#{i_name}
			,#{i_price}
			,#{reg_date}
			,#{is_del}
		)
	</insert>
	
	<!-- 식자재 update -->
	<update id="updateIngredient" parameterType="HashMap">
		update ingredient set
		ia_code  =${ia_name}
		,ib_code =${ib_name}
		,io_code =${io_name}
		,i_name  = #{i_name}
		,i_size  = #{i_size}
		where i_no = ${i_no}
			and s_no = (select s_no from store where s_id=#{s_id})
	
	</update>
	
	<!-- 식자재 삭제  -->
	<update id="deleteIngredient" parameterType="hashmap">
		update ingredient set
		is_del = 'T'
		where i_no = ${i_no}
	</update>
</mapper>